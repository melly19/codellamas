Ensure all tests pass after refactoring."
2026-02-09 12:33:08,Bookstore,"Refactor the code to eliminate Feature Envy by moving logic that depends heavily on data from one class to the class that owns that data. The example demonstrates Feature Envy in a bookstore application where the BookService class is accessing data from the ShoppingCart class more than it should, leading to poor encapsulation and readability. Students must identify the smell and refactor the code to improve maintainability while preserving behavior.",single,"{""status"": ""success"", ""message"": ""Exercise generated and saved to /Users/frederickliau/Desktop/School/codellamas/backend/src/codellamas_backend/generated_exercises/Bookstore_0902_3308"", ""data"": {""problem_description"": ""Refactor the code to eliminate Feature Envy by moving logic that depends heavily on data from one class to the class that owns that data. The example demonstrates Feature Envy in a bookstore application where the BookService class is accessing data from the ShoppingCart class more than it should, leading to poor encapsulation and readability. Students must identify the smell and refactor the code to improve maintainability while preserving behavior."", ""project_files"": [{""path"": ""src/main/java/com/example/bookstore/Book.java"", ""content"": ""package com.example.bookstore;\n\npublic class Book {\n    private String title;\n    private String author;\n    private double price;\n    private int stock;\n\n    public Book(String title, String author, double price, int stock) {\n        this.title = title;\n        this.author = author;\n        this.price = price;\n        this.stock = stock;\n    }\n\n    public String getTitle() {\n        return title;\n    }\n\n    public String getAuthor() {\n        return author;\n    }\n\n    public double getPrice() {\n        return price;\n    }\n\n    public int getStock() {\n        return stock;\n    }\n\n    public void setStock(int stock) {\n        this.stock = stock;\n    }\n}""}, {""path"": ""src/main/java/com/example/bookstore/ShoppingCart.java"", ""content"": ""package com.example.bookstore;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\npublic class ShoppingCart {\n    private List<Book> items;\n\n    public ShoppingCart() {\n        this.items = new ArrayList<>();\n    }\n\n    public void addItem(Book book) {\n        items.add(book);\n    }\n\n    public List<Book> getItems() {\n        return items;\n    }\n\n    public double getTotalPrice() {\n        double total = 0;\n        for (Book item : items) {\n            total += item.getPrice();\n        }\n        return total;\n    }\n\n    public int getItemCount() {\n        return items.size();\n    }\n}""}, {""path"": ""src/main/java/com/example/bookstore/BookService.java"", ""content"": ""package com.example.bookstore;\n\npublic class BookService {\n    public String getShoppingCartSummary(ShoppingCart cart) {\n        StringBuilder summary = new StringBuilder();\n        summary.append(\""Items in cart: \"").append(cart.getItemCount()).append(\""\\n\"");\n        summary.append(\""Total price: \"").append(cart.getTotalPrice()).append(\""\\n\"");\n        summary.append(\""Average price: \"").append(cart.getTotalPrice() / cart.getItemCount());\n        return summary.toString();\n    }\n\n    public boolean canAfford(ShoppingCart cart, double budget) {\n        return cart.getTotalPrice() <= budget;\n    }\n\n    public void processPurchase(ShoppingCart cart) {\n        // Simulate processing purchase\n        for (Book item : cart.getItems()) {\n            item.setStock(item.getStock() - 1);\n        }\n    }\n}""}, {""path"": ""src/main/java/com/example/bookstore/BookstoreApplication.java"", ""content"": ""package com.example.bookstore;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class BookstoreApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(BookstoreApplication.class, args);\n    }\n}""}, {""path"": ""src/main/java/com/example/bookstore/BookController.java"", ""content"": ""package com.example.bookstore;\n\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class BookController {\n    private final BookService bookService;\n\n    public BookController(BookService bookService) {\n        this.bookService = bookService;\n    }\n\n    @GetMapping(\""/cart-summary\"")\n    public String cartSummary() {\n        ShoppingCart cart = new ShoppingCart();\n        cart.addItem(new Book(\""Java for Beginners\"", \""John Doe\"", 29.99, 10));\n        return bookService.getShoppingCartSummary(cart);\n    }\n}""}], ""test_files"": [{""path"": ""src/test/java/com/example/bookstore/BookServiceTest.java"", ""content"": ""package com.example.bookstore;\n\nimport org.junit.jupiter.api.Test;\n\nimport static org.junit.jupiter.api.Assertions.*;\n\nclass BookServiceTest {\n\n    @Test\n    void shouldGenerateShoppingCartSummary() {\n        ShoppingCart cart = new ShoppingCart();\n        cart.addItem(new Book(\""Java for Beginners\"", \""John Doe\"", 29.99, 10));\n        cart.addItem(new Book(\""Spring Boot Guide\"", \""Jane Smith\"", 39.99, 5));\n\n        BookService service = new BookService();\n        String result = service.getShoppingCartSummary(cart);\n        assertTrue(result.contains(\""Items in cart: 2\""));\n        assertTrue(result.contains(\""Total price: 69.98\""));\n        assertTrue(result.contains(\""Average price: 34.99\""));\n    }\n\n    @Test\n    void shouldCheckIfCartIsAffordable() {\n        ShoppingCart cart = new ShoppingCart();\n        cart.addItem(new Book(\""Java for Beginners\"", \""John Doe\"", 29.99, 10));\n\n        BookService service = new BookService();\n        assertTrue(service.canAfford(cart, 35.0));\n        assertFalse(service.canAfford(cart, 25.0));\n    }\n\n    @Test\n    void shouldProcessPurchaseAndReduceStock() {\n        ShoppingCart cart = new ShoppingCart();\n        Book book = new Book(\""Java for Beginners\"", \""John Doe\"", 29.99, 10);\n        cart.addItem(book);\n\n        BookService service = new BookService();\n        service.processPurchase(cart);\n\n        assertEquals(9, book.getStock());\n    }\n}""}], ""reference_solution_markdown"": ""## Reference Solution\n\nThe original `BookService` class had Feature Envy because it was performing operations that should belong to the `ShoppingCart` class. The methods `getShoppingCartSummary`, `canAfford`, and `processPurchase` all accessed data from `ShoppingCart` more than they should.\n\n### Original Smelly Code:\n\n```java\npublic class BookService {\n    public String getShoppingCartSummary(ShoppingCart cart) {\n        StringBuilder summary = new StringBuilder();\n        summary.append(\""Items in cart: \"").append(cart.getItemCount()).append(\""\\n\"");\n        summary.append(\""Total price: \"").append(cart.getTotalPrice()).append(\""\\n\"");\n        summary.append(\""Average price: \"").append(cart.getTotalPrice() / cart.getItemCount());\n        return summary.toString();\n    }\n\n    public boolean canAfford(ShoppingCart cart, double budget) {\n        return cart.getTotalPrice() <= budget;\n    }\n\n    public void processPurchase(ShoppingCart cart) {\n        // Simulate processing purchase\n        for (Book item : cart.getItems()) {\n            item.setStock(item.getStock() - 1);\n        }\n    }\n}\n```\n\n### Refactored Solution:\nWe moved the `getShoppingCartSummary`, `canAfford`, and `processPurchase` methods from `BookService` to the `ShoppingCart` class, making them part of the class they operate on. This improves encapsulation and makes the code cleaner:\n\n```java\npublic class ShoppingCart {\n    private List<Book> items;\n\n    // ... other methods ...\n\n    public String getShoppingCartSummary() {\n        StringBuilder summary = new StringBuilder();\n        summary.append(\""Items in cart: \"").append(this.getItemCount()).append(\""\\n\"");\n        summary.append(\""Total price: \"").append(this.getTotalPrice()).append(\""\\n\"");\n        summary.append(\""Average price: \"").append(this.getTotalPrice() / this.getItemCount());\n        return summary.toString();\n    }\n\n    public boolean canAfford(double budget) {\n        return this.getTotalPrice() <= budget;\n    }\n\n    public void processPurchase() {\n        for (Book item : this.getItems()) {\n            item.setStock(item.getStock() - 1);\n        }\n    }\n}\n```\n\nThen in `BookController`, we modify the call to use the new methods:\n\n```java\n@RestController\npublic class BookController {\n    private final BookService bookService;\n\n    public BookController(BookService bookService) {\n        this.bookService = bookService;\n    }\n\n    @GetMapping(\""/cart-summary\"")\n    public String cartSummary() {\n        ShoppingCart cart = new ShoppingCart();\n        cart.addItem(new Book(\""Java for Beginners\"", \""John Doe\"", 29.99, 10));\n        return cart.getShoppingCartSummary();\n    }\n}\n```\n\nIn `BookService`, we remove these methods:\n\n```\npublic class BookService {\n    // No more shopping cart methods!\n}\n```\n\nThis refactoring eliminates Feature Envy, improves maintainability, and keeps test behavior exactly the same.""}, ""maven_verification"": {""enabled"": false}}"
2026-02-09 12:40:57,Bookstore,"Students are to identify and refactor a code smell called 'Feature Envy' in a Spring Boot bookstore application. The smell manifests when a method in one class uses data and operations from another class more than its own data and operations. Specifically, the 'calculateTotalPrice' method in the BookController class accesses book prices and quantities from the BookService, but the logic for calculating the total price should reside within the BookService. The refactoring involves moving the logic into the BookService and updating the controller to delegate the computation. Behavior must remain unchanged.",single,"{""status"": ""success"", ""message"": ""Exercise generated and saved to /Users/frederickliau/Desktop/School/codellamas/backend/src/codellamas_backend/generated_exercises/Bookstore_0902_4057"", ""data"": {""problem_description"": ""Students are to identify and refactor a code smell called 'Feature Envy' in a Spring Boot bookstore application. The smell manifests when a method in one class uses data and operations from another class more than its own data and operations. Specifically, the 'calculateTotalPrice' method in the BookController class accesses book prices and quantities from the BookService, but the logic for calculating the total price should reside within the BookService. The refactoring involves moving the logic into the BookService and updating the controller to delegate the computation. Behavior must remain unchanged."", ""project_files"": [{""path"": ""src/main/java/com/example/bookstore/BookstoreApplication.java"", ""content"": ""package com.example.bookstore;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class BookstoreApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(BookstoreApplication.class, args);\n    }\n}""}, {""path"": ""src/main/java/com/example/bookstore/Book.java"", ""content"": ""package com.example.bookstore;\n\npublic class Book {\n    private String title;\n    private double price;\n    private int quantity;\n\n    public Book(String title, double price, int quantity) {\n        this.title = title;\n        this.price = price;\n        this.quantity = quantity;\n    }\n\n    public String getTitle() {\n        return title;\n    }\n\n    public double getPrice() {\n        return price;\n    }\n\n    public int getQuantity() {\n        return quantity;\n    }\n\n    public void setPrice(double price) {\n        this.price = price;\n    }\n\n    public void setQuantity(int quantity) {\n        this.quantity = quantity;\n    }\n}""}, {""path"": ""src/main/java/com/example/bookstore/BookService.java"", ""content"": ""package com.example.bookstore;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\npublic class BookService {\n    private List<Book> books;\n\n    public BookService() {\n        this.books = new ArrayList<>();\n    }\n\n    public void addBook(Book book) {\n        books.add(book);\n    }\n\n    public List<Book> getBooks() {\n        return books;\n    }\n\n    public Book getBook(String title) {\n        return books.stream()\n                .filter(book -> book.getTitle().equals(title))\n                .findFirst()\n                .orElse(null);\n    }\n}""}, {""path"": ""src/main/java/com/example/bookstore/BookController.java"", ""content"": ""package com.example.bookstore;\n\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.List;\n\n@RestController\npublic class BookController {\n    private BookService bookService;\n\n    public BookController(BookService bookService) {\n        this.bookService = bookService;\n    }\n\n    @GetMapping(\""/total-price\"")\n    public double calculateTotalPrice(@RequestParam String title, @RequestParam int quantity) {\n        Book book = bookService.getBook(title);\n        if (book != null) {\n            double bookPrice = book.getPrice();\n            int bookQuantity = book.getQuantity();\n            // Feature Envy: This method accesses Book data but does computation for the price\n            return bookPrice * quantity;\n        }\n        return 0.0;\n    }\n}""}], ""test_files"": [{""path"": ""src/test/java/com/example/bookstore/BookControllerTest.java"", ""content"": ""package com.example.bookstore;\n\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport static org.junit.jupiter.api.Assertions.*;\n\npublic class BookControllerTest {\n\n    private BookService bookService;\n    private BookController bookController;\n\n    @BeforeEach\n    void setUp() {\n        bookService = new BookService();\n        bookController = new BookController(bookService);\n\n        Book book1 = new Book(\""Java Basics\"", 25.0, 10);\n        Book book2 = new Book(\""Spring Boot Guide\"", 30.0, 3);\n        bookService.addBook(book1);\n        bookService.addBook(book2);\n    }\n\n    @Test\n    void shouldCalculateCorrectTotalPrice() {\n        double result = bookController.calculateTotalPrice(\""Java Basics\"", 2);\n        assertEquals(50.0, result);\n    }\n\n    @Test\n    void shouldReturnZeroForNonExistentBook() {\n        double result = bookController.calculateTotalPrice(\""Unknown Book\"", 2);\n        assertEquals(0.0, result);\n    }\n}""}], ""reference_solution_markdown"": ""### Original Code (with Feature Envy)\n\n**BookController.java**\n```java\n@GetMapping(\""/total-price\"")\npublic double calculateTotalPrice(@RequestParam String title, @RequestParam int quantity) {\n    Book book = bookService.getBook(title);\n    if (book != null) {\n        double bookPrice = book.getPrice();\n        int bookQuantity = book.getQuantity();\n        // Feature Envy: This method accesses Book data but does computation for the price\n        return bookPrice * quantity;\n    }\n    return 0.0;\n}\n```\n\n### Refactored Code\n\n**BookService.java**\n```java\npublic double calculateTotalPrice(String title, int quantity) {\n    Book book = getBook(title);\n    if (book != null) {\n        return book.getPrice() * quantity;\n    }\n    return 0.0;\n}\n```\n\n**BookController.java**\n```java\n@GetMapping(\""/total-price\"")\npublic double calculateTotalPrice(@RequestParam String title, @RequestParam int quantity) {\n    return bookService.calculateTotalPrice(title, quantity);\n}\n```""}, ""maven_verification"": {""enabled"": false}}"
2026-02-09 12:53:07,Bookstore,"Refactor the given Spring Boot bookstore application to eliminate the Feature Envy code smell. The smell occurs when a method in one class uses more methods from another class than from its own class. In this exercise, the BookService class accesses fields and methods of the Book class more than its own methods, indicating a misplaced responsibility. You must refactor to move behavior to the Book class itself while maintaining all observable behavior.",single,"{""status"": ""success"", ""message"": ""Exercise generated and saved to /Users/frederickliau/Desktop/School/codellamas/backend/src/codellamas_backend/generated_exercises/Bookstore_0902_5307"", ""data"": {""problem_description"": ""Refactor the given Spring Boot bookstore application to eliminate the Feature Envy code smell. The smell occurs when a method in one class uses more methods from another class than from its own class. In this exercise, the BookService class accesses fields and methods of the Book class more than its own methods, indicating a misplaced responsibility. You must refactor to move behavior to the Book class itself while maintaining all observable behavior."", ""project_files"": [{""path"": ""src/main/java/com/example/bookstore/Book.java"", ""content"": ""package com.example.bookstore;\n\npublic class Book {\n    private String title;\n    private String author;\n    private double price;\n    private int year;\n\n    public Book(String title, String author, double price, int year) {\n        this.title = title;\n        this.author = author;\n        this.price = price;\n        this.year = year;\n    }\n\n    public String getTitle() {\n        return title;\n    }\n\n    public String getAuthor() {\n        return author;\n    }\n\n    public double getPrice() {\n        return price;\n    }\n\n    public int getYear() {\n        return year;\n    }\n\n    public boolean isExpensive() {\n        return price > 50.0;\n    }\n\n    public boolean isClassic() {\n        return year < 1950;\n    }\n\n    public String getBookInfo() {\n        return title + \"" by \"" + author + \"" (\"" + year + \"")\"";\n    }\n}\n""}, {""path"": ""src/main/java/com/example/bookstore/BookService.java"", ""content"": ""package com.example.bookstore;\n\nimport java.util.List;\nimport java.util.stream.Collectors;\n\npublic class BookService {\n    public boolean isBookExpensive(Book book) {\n        return book.getPrice() > 50.0;\n    }\n\n    public boolean isBookClassic(Book book) {\n        return book.getYear() < 1950;\n    }\n\n    public String getAuthorTitle(Book book) {\n        return book.getAuthor() + \"" - \"" + book.getTitle();\n    }\n\n    public List<String> getExpensiveBookTitles(List<Book> books) {\n        return books.stream()\n                .filter(book -> isBookExpensive(book))\n                .map(Book::getTitle)\n                .collect(Collectors.toList());\n    }\n\n    public List<String> getClassicAuthors(List<Book> books) {\n        return books.stream()\n                .filter(book -> isBookClassic(book))\n                .map(Book::getAuthor)\n                .collect(Collectors.toList());\n    }\n}\n""}, {""path"": ""src/main/java/com/example/bookstore/BookstoreApplication.java"", ""content"": ""package com.example.bookstore;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SprinBootApplication\npublic class BookstoreApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(BookstoreApplication.class, args);\n    }\n}\n""}, {""path"": ""pom.xml"", ""content"": ""<?xml version=\""1.0\"" encoding=\""UTF-8\""?>\n<project xmlns=\""http://maven.apache.org/POM/4.0.0\""\n         xmlns:xsi=\""http://www.w3.org/2001/XMLSchema-instance\""\n         xsi:schemaLocation=\""http://maven.apache.org/POM/4.0.0\n         http://maven.apache.org/xsd/maven-4.0.0.xsd\"">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>com.example</groupId>\n    <artifactId>bookstore</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>bookstore</name>\n    <description>Demo Project for Spring Boot</description>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.7.0</version>\n        <relativePath/>\n    </parent>\n\n    <properties>\n        <java.version>11</java.version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n""}], ""test_files"": [{""path"": ""src/test/java/com/example/bookstore/BookServiceTest.java"", ""content"": ""package com.example.bookstore;\n\nimport org.junit.jupiter.api.Test;\nimport java.util.Arrays;\nimport java.util.List;\nimport static org.junit.jupiter.api.Assertions.*;\n\nclass BookServiceTest {\n\n    private BookService bookService = new BookService();\n\n    @Test\n    void testIsBookExpensive() {\n        Book book = new Book(\""1984\"", \""George Orwell\"", 60.0, 1948);\n        assertTrue(bookService.isBookExpensive(book));\n    }\n\n    @Test\n    void testIsBookClassic() {\n        Book book = new Book(\""A Tale of Two Cities\"", \""Charles Dickens\"", 15.0, 1859);\n        assertTrue(bookService.isBookClassic(book));\n    }\n\n    @Test\n    void testGetAuthorTitle() {\n        Book book = new Book(\""Brave New World\"", \""Aldous Huxley\"", 20.0, 1932);\n        assertEquals(\""Aldous Huxley - Brave New World\"", bookService.getAuthorTitle(book));\n    }\n\n    @Test\n    void testGetExpensiveBookTitles() {\n        Book book1 = new Book(\""1984\"", \""George Orwell\"", 60.0, 1948);\n        Book book2 = new Book(\""Animal Farm\"", \""George Orwell\"", 10.0, 1945);\n        Book book3 = new Book(\""To Kill a Mockingbird\"", \""Harper Lee\"", 70.0, 1960);\n        List<Book> books = Arrays.asList(book1, book2, book3);\n        List<String> expected = Arrays.asList(\""1984\"", \""To Kill a Mockingbird\"");\n        assertEquals(expected, bookService.getExpensiveBookTitles(books));\n    }\n\n    @Test\n    void testGetClassicAuthors() {\n        Book book1 = new Book(\""1984\"", \""George Orwell\"", 60.0, 1948);\n        Book book2 = new Book(\""The Great Gatsby\"", \""F. Scott Fitzgerald\"", 15.0, 1925);\n        Book book3 = new Book(\""Brave New World\"", \""Aldous Huxley\"", 20.0, 1932);\n        List<Book> books = Arrays.asList(book1, book2, book3);\n        List<String> expected = Arrays.asList(\""George Orwell\"", \""F. Scott Fitzgerald\"", \""Aldous Huxley\"");\n        assertEquals(expected, bookService.getClassicAuthors(books));\n    }\n}\n""}], ""reference_solution_markdown"": ""## Reference Solution\n\n### Original Smelly Code\nThe `BookService` class had Feature Envy because it accessed the `Book` class's fields and methods more than its own internal methods. Specifically:\n- `isBookExpensive(Book book)` accesses `book.getPrice()`\n- `isBookClassic(Book book)` accesses `book.getYear()`\n- `getAuthorTitle(Book book)` accesses `book.getAuthor()` and `book.getTitle()`\n\nThe refactored solution moves these methods directly to the `Book` class.\n\n### Refactored Code\nAll behavior was moved to the `Book` class:\n\n**Book.java**\n```java\npublic class Book {\n    private String title;\n    private String author;\n    private double price;\n    private int year;\n\n    public Book(String title, String author, double price, int year) {\n        this.title = title;\n        this.author = author;\n        this.price = price;\n        this.year = year;\n    }\n\n    public String getTitle() { return title; }\n    public String getAuthor() { return author; }\n    public double getPrice() { return price; }\n    public int getYear() { return year; }\n    public boolean isExpensive() { return price > 50.0; }\n    public boolean isClassic() { return year < 1950; }\n    public String getBookInfo() { return title + \"" by \"" + author + \"" (\"" + year + \"")\""; }\n    public String getAuthorTitle() { return author + \"" - \"" + title; }\n}\n```\n\n**BookService.java** (simplified)\n```java\npublic class BookService {\n    public List<String> getExpensiveBookTitles(List<Book> books) {\n        return books.stream()\n                .filter(Book::isExpensive)\n                .map(Book::getTitle)\n                .collect(Collectors.toList());\n    }\n\n    public List<String> getClassicAuthors(List<Book> books) {\n        return books.stream()\n                .filter(Book::isClassic)\n                .map(Book::getAuthor)\n                .collect(Collectors.toList());\n    }\n}\n```""}, ""maven_verification"": {""enabled"": false}}"
