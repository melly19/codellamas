generate_exercise:
  description: |
    RETURN ONLY VALID JSON. NO MARKDOWN. NO EXTRA TEXT.
    Start with "{" and end with "}".
    All newlines inside strings must be escaped as "\n".

    Inputs:
    - topic: {topic}
    - code_smells: {code_smells}
    - seed: {seed}
    - project_context: {project_context}

    You are generating a Java Spring Boot refactoring exercise for students.
    Use ONE primary smell: if code_smells is non-empty, primary_smell = first element; else "General Refactoring".

    REQUIRED JSON SCHEMA (exact keys):
    {
      "problem_md": "markdown string",
      "instructions_md": "markdown string",
      "tests": { "relative/path/Test.java": "file content" },
      "solution": { "relative/path/File.java": "file content" },
      "review_notes": "string"
    }

    Constraints:
    - Keep changes small: 1â€“3 files in src/main/java/** and 1 file in src/test/java/**.
    - Tests must be JUnit 5, runnable via "mvn test".
    - No external dependencies (no DB, no network, no Spring context unless truly needed).
    - Prefer using package names found in project_context; if missing assume com.example.demo.

  expected_output: |
    A single valid JSON object with keys: problem_md, instructions_md, tests, solution, review_notes.
  agent: general_agent


repair_exercise:
  description: |
    RETURN ONLY VALID JSON. NO MARKDOWN. NO EXTRA TEXT.
    Start with "{" and end with "}".

    Convert the text into a single JSON object with EXACT keys:
    {
      "problem_md": "markdown string",
      "instructions_md": "markdown string",
      "tests": { "path": "file content" },
      "solution": { "path": "file content" },
      "review_notes": "string"
    }

    Text to repair:
    {non_json_output}

    Rules:
    - If missing, set strings to "" and maps to {}.
    - tests and solution MUST be dicts of path -> full file contents.

  expected_output: |
    A single valid JSON object with the required keys.
  agent: general_agent


review_solution:
  description: |
    RETURN ONLY VALID JSON. NO MARKDOWN. NO EXTRA TEXT.
    Start with "{" and end with "}".

    Inputs:
    - problem_description: {problem_description}
    - original_code: {original_code}
    - student_code: {student_code}
    - test_results: {test_results}
    - seed: {seed}

    Produce feedback comparing student_code to original_code and the test_results.
    REQUIRED JSON SCHEMA:
    {
      "score": 0,
      "passed_tests": [],
      "failed_tests": [],
      "feedback": "",
      "suggestions": [],
      "critical_issues": []
    }

    Rules:
    - score is 0-100 integer.
    - passed_tests/failed_tests should be inferred from test_results text.
    - feedback should be concise and actionable.

  expected_output: |
    A single valid JSON object with keys: score, passed_tests, failed_tests, feedback, suggestions, critical_issues.
  agent: general_agent
