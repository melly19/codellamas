{
    "status": "success",
    "message": "Exercise generated and saved to /Users/frederickliau/Desktop/School/codellamas/backend/src/codellamas_backend/generated_exercises/Bookstore_1602_0310",
    "data": {
        "problem_description": "**Problem Description**\n\nYou are working on a Bookstore application that manages book inventory, customer orders, and generates reports. You have been tasked with identifying and refactoring **Feature Envy** code smells in the existing code.\n\n**Exercise Details**\n\nStudents should examine the `BookstoreService` class and identify where methods are accessing data from other objects instead of being defined within them. This is a classic case of Feature Envy, where behavior that logically belongs to one class is implemented in another.\n\n**Code Smells**\n\n*Feature Envy*: A method uses data from another object (or objects) more than it uses its own data. The method should be moved to the class of the object it's using the most. Often it's composable to take the behavior that's in the main class and put it into the alternative.\n\nThe `BookstoreService` class will contain methods that access fields from `Book` or `Order` objects, which should instead be moved to those objects.\n\n**Files to Modify**\n\nOnly modify the `BookstoreService.java` file.",
        "project_files": [
            {
                "path": "pom.xml",
                "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>com.example</groupId>\n    <artifactId>bookstore</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>bookstore</name>\n    <description>Demo project for Spring Boot</description>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.5.4</version>\n        <relativePath/>\n    </parent>\n\n    <properties>\n        <java.version>11</java.version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n</project>"
            },
            {
                "path": "src/main/java/com/example/bookstore/Book.java",
                "content": "package com.example.bookstore;\n\npublic class Book {\n    private String title;\n    private String author;\n    private double price;\n    private int stock;\n    \n    public Book(String title, String author, double price, int stock) {\n        this.title = title;\n        this.author = author;\n        this.price = price;\n        this.stock = stock;\n    }\n    \n    public String getTitle() {\n        return title;\n    }\n    \n    public String getAuthor() {\n        return author;\n    }\n    \n    public double getPrice() {\n        return price;\n    }\n    \n    public int getStock() {\n        return stock;\n    }\n    \n    public void setStock(int stock) {\n        this.stock = stock;\n    }\n}"
            },
            {
                "path": "src/main/java/com/example/bookstore/Order.java",
                "content": "package com.example.bookstore;\n\nimport java.util.List;\n\npublic class Order {\n    private List<Book> books;\n    private String customerName;\n    \n    public Order(List<Book> books, String customerName) {\n        this.books = books;\n        this.customerName = customerName;\n    }\n    \n    public List<Book> getBooks() {\n        return books;\n    }\n    \n    public String getCustomerName() {\n        return customerName;\n    }\n}"
            },
            {
                "path": "src/main/java/com/example/bookstore/BookstoreService.java",
                "content": "package com.example.bookstore;\n\nimport org.springframework.stereotype.Service;\nimport java.util.ArrayList;\nimport java.util.List;\n\n@Service\npublic class BookstoreService {\n    \n    public String getMostExpensiveBookTitle(List<Book> books) {\n        Book mostExpensive = null;\n        double maxPrice = 0;\n        for (Book book : books) {\n            if (book.getPrice() > maxPrice) {\n                maxPrice = book.getPrice();\n                mostExpensive = book;\n            }\n        }\n        return mostExpensive != null ? mostExpensive.getTitle() : \"No books found\";\n    }\n    \n    public double calculateOrderTotal(Order order) {\n        double total = 0;\n        for (Book book : order.getBooks()) {\n            total += book.getPrice();\n        }\n        return total;\n    }\n    \n    public String getAuthorWithMostBooks(List<Book> books) {\n        String mostFrequentAuthor = null;\n        int maxCount = 0;\n        for (Book book : books) {\n            int count = 0;\n            for (Book b : books) {\n                if (b.getAuthor().equals(book.getAuthor())) {\n                    count++;\n                }\n            }\n            if (count > maxCount) {\n                maxCount = count;\n                mostFrequentAuthor = book.getAuthor();\n            }\n        }\n        return mostFrequentAuthor;\n    }\n    \n    public boolean isOrderValid(Order order) {\n        return order.getCustomerName() != null && !order.getCustomerName().isEmpty() && !order.getBooks().isEmpty();\n    }\n    \n    public int getTotalBookStock(List<Book> books) {\n        int total = 0;\n        for (Book book : books) {\n            total += book.getStock();\n        }\n        return total;\n    }\n}"
            },
            {
                "path": "src/main/java/com/example/bookstore/BookstoreApplication.java",
                "content": "package com.example.bookstore;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class BookstoreApplication {\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(BookstoreApplication.class, args);\n\t}\n\n}"
            },
            {
                "path": "src/main/java/com/example/bookstore/BookstoreController.java",
                "content": "package com.example.bookstore;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport java.util.List;\n\n@RestController\npublic class BookstoreController {\n    \n    @Autowired\n    private BookstoreService bookstoreService;\n    \n    @GetMapping(\"/books/title\")\n    public String getMostExpensiveTitle() {\n        List<Book> books = List.of(\n            new Book(\"Java Guide\", \"John Doe\", 29.99, 10),\n            new Book(\"Spring Boot\", \"Jane Smith\", 39.99, 5)\n        );\n        return bookstoreService.getMostExpensiveBookTitle(books);\n    }\n    \n    @GetMapping(\"/order/total\")\n    public double getOrderTotal() {\n        List<Book> books = List.of(\n            new Book(\"Java Guide\", \"John Doe\", 29.99, 10),\n            new Book(\"Spring Boot\", \"Jane Smith\", 39.99, 5)\n        );\n        Order order = new Order(books, \"Alice Johnson\");\n        return bookstoreService.calculateOrderTotal(order);\n    }\n}"
            }
        ],
        "test_files": [
            {
                "path": "src/test/java/com/example/bookstore/BookstoreServiceTest.java",
                "content": "package com.example.bookstore;\n\nimport org.junit.jupiter.api.Test;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport java.util.List;\nimport static org.junit.jupiter.api.Assertions.*;\n\n@SpringBootTest\npublic class BookstoreServiceTest {\n\n    @Test\n    public void testGetMostExpensiveBookTitle() {\n        BookstoreService service = new BookstoreService();\n        List<Book> books = List.of(\n            new Book(\"Java Guide\", \"John Doe\", 29.99, 10),\n            new Book(\"Spring Boot\", \"Jane Smith\", 39.99, 5),\n            new Book(\"Clean Code\", \"Robert Martin\", 49.99, 3)\n        );\n        String result = service.getMostExpensiveBookTitle(books);\n        assertEquals(\"Clean Code\", result);\n    }\n\n    @Test\n    public void testCalculateOrderTotal() {\n        BookstoreService service = new BookstoreService();\n        List<Book> books = List.of(\n            new Book(\"Java Guide\", \"John Doe\", 29.99, 10),\n            new Book(\"Spring Boot\", \"Jane Smith\", 39.99, 5)\n        );\n        Order order = new Order(books, \"Alice Johnson\");\n        double result = service.calculateOrderTotal(order);\n        assertEquals(69.98, result, 0.01);\n    }\n\n    @Test\n    public void testGetAuthorWithMostBooks() {\n        BookstoreService service = new BookstoreService();\n        List<Book> books = List.of(\n            new Book(\"Java Guide\", \"John Doe\", 29.99, 10),\n            new Book(\"Spring Boot\", \"Jane Smith\", 39.99, 5),\n            new Book(\"Java Patterns\", \"John Doe\", 34.99, 8)\n        );\n        String result = service.getAuthorWithMostBooks(books);\n        assertEquals(\"John Doe\", result);\n    }\n\n    @Test\n    public void testIsOrderValidWithValidOrder() {\n        BookstoreService service = new BookstoreService();\n        List<Book> books = List.of(new Book(\"Java Guide\", \"John Doe\", 29.99, 10));\n        Order order = new Order(books, \"Alice Johnson\");\n        assertTrue(service.isOrderValid(order));\n    }\n\n    @Test\n    public void testIsOrderValidWithInvalidOrder() {\n        BookstoreService service = new BookstoreService();\n        Order order = new Order(List.of(), \"\");\n        assertFalse(service.isOrderValid(order));\n    }\n\n    @Test\n    public void testGetTotalBookStock() {\n        BookstoreService service = new BookstoreService();\n        List<Book> books = List.of(\n            new Book(\"Java Guide\", \"John Doe\", 29.99, 10),\n            new Book(\"Spring Boot\", \"Jane Smith\", 39.99, 5)\n        );\n        int result = service.getTotalBookStock(books);\n        assertEquals(15, result);\n    }\n}"
            }
        ],
        "solution_explanation_md": "## Solution Explanation\n\nThe main code smell in this exercise is **Feature Envy**. The methods `getMostExpensiveBookTitle`, `calculateOrderTotal`, `getAuthorWithMostBooks`, `isOrderValid`, and `getTotalBookStock` in `BookstoreService` access data from `Book` and `Order` objects without being defined within those classes. This leads to poor encapsulation and violation of the principle that logic should reside close to the data it operates on.\n\nTo fix this:\n\n1. **Add methods to `Book` class:**\n   - Create `getPrice()` method (already present)\n   - Create `getStock()` method (already present)\n   - Create `getTitle()` method (already present)\n   - Add methods to encapsulate behavior\n\n2. **Add methods to `Order` class:**\n   - Add `getTotalPrice()` method\n   - Add `isValid()` method\n\n3. **Refactor `BookstoreService` methods:**\n   - Instead of iterating through books directly in `getMostExpensiveBookTitle`, call `getPrice()` on the books\n   - In `calculateOrderTotal`, instead of iterating, use `getTotalPrice` from `Order`\n   - Move business logic from `BookstoreService` methods to appropriate classes to eliminate object obsession\n\nAfter refactoring, `BookstoreService` can be depurposed to only encapsulate business logic that spans multiple components (like order processing), not operations specifically about individual entities.\n\nThe key insight is to identify which behavior belongs to which class and move it there. Once that's done, the methods in the `BookstoreService` class will use the proper encapsulated methods instead of directly accessing data fields of other objects.",
        "paths_to_ex": [
            "src/main/java/com/example/bookstore/BookstoreService.java"
        ],
        "answers_list": [
            {
                "path": "BookstoreService.java",
                "content": "package com.example.bookstore;\n\nimport org.springframework.stereotype.Service;\nimport java.util.ArrayList;\nimport java.util.List;\n\n@Service\npublic class BookstoreService {\n    \n    public String getMostExpensiveBookTitle(List<Book> books) {\n        Book mostExpensive = null;\n        double maxPrice = 0;\n        for (Book book : books) {\n            if (book.getPrice() > maxPrice) {\n                maxPrice = book.getPrice();\n                mostExpensive = book;\n            }\n        }\n        return mostExpensive != null ? mostExpensive.getTitle() : \"No books found\";\n    }\n    \n    public double calculateOrderTotal(Order order) {\n        return order.getTotalPrice();\n    }\n    \n    public String getAuthorWithMostBooks(List<Book> books) {\n        String mostFrequentAuthor = null;\n        int maxCount = 0;\n        for (Book book : books) {\n            int count = 0;\n            for (Book b : books) {\n                if (b.getAuthor().equals(book.getAuthor())) {\n                    count++;\n                }\n            }\n            if (count > maxCount) {\n                maxCount = count;\n                mostFrequentAuthor = book.getAuthor();\n            }\n        }\n        return mostFrequentAuthor;\n    }\n    \n    public boolean isOrderValid(Order order) {\n        return order.isValid();\n    }\n    \n    public int getTotalBookStock(List<Book> books) {\n        int total = 0;\n        for (Book book : books) {\n            total += book.getStock();\n        }\n        return total;\n    }\n}"
            }
        ]
    },
    "answers_list": "## Solution Explanation\n\nThe main code smell in this exercise is **Feature Envy**. The methods `getMostExpensiveBookTitle`, `calculateOrderTotal`, `getAuthorWithMostBooks`, `isOrderValid`, and `getTotalBookStock` in `BookstoreService` access data from `Book` and `Order` objects without being defined within those classes. This leads to poor encapsulation and violation of the principle that logic should reside close to the data it operates on.\n\nTo fix this:\n\n1. **Add methods to `Book` class:**\n   - Create `getPrice()` method (already present)\n   - Create `getStock()` method (already present)\n   - Create `getTitle()` method (already present)\n   - Add methods to encapsulate behavior\n\n2. **Add methods to `Order` class:**\n   - Add `getTotalPrice()` method\n   - Add `isValid()` method\n\n3. **Refactor `BookstoreService` methods:**\n   - Instead of iterating through books directly in `getMostExpensiveBookTitle`, call `getPrice()` on the books\n   - In `calculateOrderTotal`, instead of iterating, use `getTotalPrice` from `Order`\n   - Move business logic from `BookstoreService` methods to appropriate classes to eliminate object obsession\n\nAfter refactoring, `BookstoreService` can be depurposed to only encapsulate business logic that spans multiple components (like order processing), not operations specifically about individual entities.\n\nThe key insight is to identify which behavior belongs to which class and move it there. Once that's done, the methods in the `BookstoreService` class will use the proper encapsulated methods instead of directly accessing data fields of other objects.",
    "maven_verification": {
        "enabled": false
    }
}